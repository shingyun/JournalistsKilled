var ImageInterface = require('../src/Image');
var Box = require('../src/Box');

module.exports = class Image extends ImageInterface {
	constructor(jimp) {
		super();
		this._jimp = jimp;
	}

	getSize() {
		return Promise.resolve(new Box(this._jimp.bitmap.width, this._jimp.bitmap.height));
	}

	crop(zone) {
		this._jimp.crop(
			zone.getStartPoint().getX(),
			zone.getStartPoint().getY(),
			zone.getSize().getWidth(),
			zone.getSize().getHeight()
		);
		return Promise.resolve(this);
	}

	saveJPEG(file, quality) {
		return new Promise((resolve, reject) => {
			if (quality !== undefined) {
				this._jimp.quality(quality);
			}
			this._jimp.write(file, err => {
				if (err) {
					return reject(err);
				}
				resolve(this);
			});
		})
	}
}